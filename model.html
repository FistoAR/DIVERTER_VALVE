<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Model Viewer Material Animation</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background: #f0f0f0;
    }
    model-viewer {
      width: 600px;
      height: 400px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 12px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: #ff6f6f;
      color: white;
    }
  </style>
</head>
<body>

<model-viewer id="mv" 
  src="https://modelviewer.dev/shared-assets/models/Astronaut.glb" 
  camera-controls 
  auto-rotate 
  ar>
</model-viewer>

<button id="changeMat">Change Material</button>

<script>
  const modelViewer = document.getElementById('mv');
  const button = document.getElementById('changeMat');

  let animating = false;
  let direction = 1; 
  let alpha = 0.2;

  button.addEventListener('click', async () => {
    await modelViewer.updateComplete;

    const materials = modelViewer.model.materials;
    if (!materials || materials.length === 0) {
      console.warn("No materials found in model.");
      return;
    }

    // Pick the first material (for Astronaut.glb this is "spacesuit")
    const mat = materials[0];

    // Set base color to #ff6f6f with alpha = 0.2
    mat.pbrMetallicRoughness.setBaseColorFactor([1.0, 0.435, 0.435, alpha]);

    // Force alpha blend mode
    mat.setAlphaMode("BLEND");

    // Ensure transparency works
    if (mat.threeMaterial) {
      mat.threeMaterial.transparent = true;
      mat.threeMaterial.needsUpdate = true;
    }

    if (!animating) {
      animating = true;
      animateAlpha(mat);
    }
  });

  function animateAlpha(mat) {
    function step() {
      alpha += direction * 0.005;

      if (alpha >= 0.45) {
        alpha = 0.45;
        direction = -1;
      } else if (alpha <= 0.2) {
        alpha = 0.2;
        direction = 1;
      }

      // Update baseColorFactor with animated alpha
      mat.pbrMetallicRoughness.setBaseColorFactor([1.0, 0.435, 0.435, alpha]);

      requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }
</script>

</body>
</html>
